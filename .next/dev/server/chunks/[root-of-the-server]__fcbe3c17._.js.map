{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/job/meowcat/app/api/route.js"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { from, of } from \"rxjs\";\r\nimport { concatMap, delay, map } from \"rxjs/operators\";\r\n\r\nconst MESSAGES = `卧槽，还真挺有效果的哦。夜阑卧听风吹雨，铁马冰河入梦来。东风夜放花千树，更吹落，星如雨。宝马雕车香满路。凤箫声动，玉壶光转，一夜鱼龙舞。蛾儿雪柳黄金缕，笑语盈盈暗香去。众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。`;\r\n\r\nexport async function GET(req) {\r\n  const encoder = new TextEncoder();\r\n\r\n  const stream = new ReadableStream({\r\n    async start(controller) {\r\n      const chars = Array.from(MESSAGES);\r\n\r\n      const subscription = from(chars).pipe(\r\n        concatMap((char) => of(char).pipe(delay(30 + Math.random() * 50))),\r\n      );\r\n\r\n      map((char) => {\r\n        return `data: ${JSON.stringify({ content: char })}\\n\\n`;\r\n      });\r\n    },\r\n  }).subscribe({\r\n    next: (encodedChunk) => {\r\n      controller.enqueue(encoder.encode(encodedChunk));\r\n    },\r\n    complete: () => {\r\n      controller.close();\r\n    },\r\n    error: (err) => {\r\n      console.error(\"Stream error:\", err);\r\n      controller.error(err);\r\n    },\r\n  });\r\n  req.signal.addEventListener(\"abort\", () => {\r\n    subscription.unsubscribe();\r\n  });\r\n\r\n  return new NextResponse(stream, {\r\n    headers: {\r\n      \"Content-Type\": \"text/event-stream\", // 必须声明是事件流\r\n      \"Cache-Control\": \"no-cache\",\r\n      Connection: \"keep-alive\",\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,WAAW,CAAC,4GAA4G,CAAC;AAExH,eAAe,IAAI,GAAG;IAC3B,MAAM,UAAU,IAAI;IAEpB,MAAM,SAAS,IAAI,eAAe;QAChC,MAAM,OAAM,WAAU;YACpB,MAAM,QAAQ,MAAM,IAAI,CAAC;YAEzB,MAAM,gBAAe,IAAA,uMAAI,EAAC,OAAO,IAAI,CACnC,IAAA,yNAAS,EAAC,CAAC,OAAS,IAAA,qMAAE,EAAC,MAAM,IAAI,CAAC,IAAA,qNAAK,EAAC,KAAK,KAAK,MAAM,KAAK;YAG/D,IAAA,mNAAG,EAAC,CAAC;gBACH,OAAO,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;oBAAE,SAAS;gBAAK,GAAG,IAAI,CAAC;YACzD;QACF;IACF,GAAG,SAAS,CAAC;QACX,MAAM,CAAC;YACL,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;QACpC;QACA,UAAU;YACR,WAAW,KAAK;QAClB;QACA,OAAO,CAAC;YACN,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,WAAW,KAAK,CAAC;QACnB;IACF;IACA,IAAI,MAAM,CAAC,gBAAgB,CAAC,SAAS;QACnC,aAAa,WAAW;IAC1B;IAEA,OAAO,IAAI,+PAAY,CAAC,QAAQ;QAC9B,SAAS;YACP,gBAAgB;YAChB,iBAAiB;YACjB,YAAY;QACd;IACF;AACF","debugId":null}}]
}