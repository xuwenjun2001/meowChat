{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/job/meowcat/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///D:/job/meowcat/auth.ts"],"sourcesContent":["// auth.ts\r\nimport NextAuth from \"next-auth\";\r\nimport GitHub from \"next-auth/providers/github\";\r\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\r\nimport { prisma } from \"./lib/prisma\";\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth({\r\n  adapter: PrismaAdapter(prisma), // 告诉 Auth.js 把数据存到哪里\r\n  providers: [GitHub], // 启用 GitHub 登录\r\n  callbacks: {\r\n    // 修复一个小 Bug：确保 userId 能够传给前端\r\n    session({ session, user }) {\r\n      if (session.user) {\r\n        session.user.id = user.id;\r\n      }\r\n      return session;\r\n    },\r\n  },\r\n});\r\n"],"names":[],"mappings":"AAAA,UAAU;;;;;;;;;;;AACV;AACA;AAAA;AACA;AACA;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,8QAAQ,EAAC;IAC1D,SAAS,IAAA,iRAAa,EAAC,yHAAM;IAC7B,WAAW;QAAC,8NAAM;KAAC;IACnB,WAAW;QACT,6BAA6B;QAC7B,SAAQ,EAAE,OAAO,EAAE,IAAI,EAAE;YACvB,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,KAAK,EAAE;YAC3B;YACA,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///D:/job/meowcat/app/api/chat/route.ts"],"sourcesContent":["import { createOpenAI } from \"@ai-sdk/openai\";\r\nimport { streamText, convertToModelMessages, type UIMessage } from \"ai\";\r\nimport { auth } from \"@/auth\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nconst deepseek = createOpenAI({\r\n  baseURL: \"https://api.siliconflow.cn/v1\",\r\n  apiKey: process.env.SILICONFLOW_API_KEY,\r\n});\r\n\r\nfunction extractTextFromUIMessage(msg: UIMessage): string {\r\n  return (msg.parts ?? [])\r\n    .filter((p) => p.type === \"text\")\r\n    .map((p: any) => p.text ?? \"\")\r\n    .join(\"\");\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const session = await auth();\r\n  if (!session?.user?.id) return new Response(\"Unauthorized\", { status: 401 });\r\n\r\n  const { messages, chatId }: { messages: UIMessage[]; chatId: string } =\r\n    await req.json();\r\n\r\n  const modelMessages = await convertToModelMessages(messages); // 注意要 await :contentReference[oaicite:1]{index=1}\r\n\r\n  const result = streamText({\r\n    model: deepseek(\"deepseek-ai/DeepSeek-R1-0528-Qwen3-8B\"),\r\n    messages: modelMessages,\r\n\r\n    onFinish: async ({ text }) => {\r\n      const last = messages[messages.length - 1];\r\n      const userText =\r\n        last?.role === \"user\" ? extractTextFromUIMessage(last) : \"\";\r\n      const aiContent = text ?? \"\";\r\n\r\n      if (!userText || !aiContent) return;\r\n\r\n      await prisma.$transaction(async (tx) => {\r\n        await tx.chat.upsert({\r\n          where: { id: chatId },\r\n          create: {\r\n            id: chatId,\r\n            userId: session.user.id,\r\n            title: userText.slice(0, 20) || \"新对话\",\r\n          },\r\n          update: {},\r\n        });\r\n\r\n        await tx.message.create({\r\n          data: { chatId, role: \"user\", content: userText },\r\n        });\r\n        await tx.message.create({\r\n          data: { chatId, role: \"assistant\", content: aiContent },\r\n        });\r\n      });\r\n    },\r\n  });\r\n\r\n  return result.toUIMessageStreamResponse(); // 见第 2 点\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,WAAW,IAAA,+PAAY,EAAC;IAC5B,SAAS;IACT,QAAQ,QAAQ,GAAG,CAAC,mBAAmB;AACzC;AAEA,SAAS,yBAAyB,GAAc;IAC9C,OAAO,CAAC,IAAI,KAAK,IAAI,EAAE,EACpB,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK,QACzB,GAAG,CAAC,CAAC,IAAW,EAAE,IAAI,IAAI,IAC1B,IAAI,CAAC;AACV;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,UAAU,MAAM,IAAA,8GAAI;IAC1B,IAAI,CAAC,SAAS,MAAM,IAAI,OAAO,IAAI,SAAS,gBAAgB;QAAE,QAAQ;IAAI;IAE1E,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GACxB,MAAM,IAAI,IAAI;IAEhB,MAAM,gBAAgB,MAAM,IAAA,mPAAsB,EAAC,WAAW,kDAAkD;IAEhH,MAAM,SAAS,IAAA,uOAAU,EAAC;QACxB,OAAO,SAAS;QAChB,UAAU;QAEV,UAAU,OAAO,EAAE,IAAI,EAAE;YACvB,MAAM,OAAO,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;YAC1C,MAAM,WACJ,MAAM,SAAS,SAAS,yBAAyB,QAAQ;YAC3D,MAAM,YAAY,QAAQ;YAE1B,IAAI,CAAC,YAAY,CAAC,WAAW;YAE7B,MAAM,yHAAM,CAAC,YAAY,CAAC,OAAO;gBAC/B,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;oBACnB,OAAO;wBAAE,IAAI;oBAAO;oBACpB,QAAQ;wBACN,IAAI;wBACJ,QAAQ,QAAQ,IAAI,CAAC,EAAE;wBACvB,OAAO,SAAS,KAAK,CAAC,GAAG,OAAO;oBAClC;oBACA,QAAQ,CAAC;gBACX;gBAEA,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;oBACtB,MAAM;wBAAE;wBAAQ,MAAM;wBAAQ,SAAS;oBAAS;gBAClD;gBACA,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;oBACtB,MAAM;wBAAE;wBAAQ,MAAM;wBAAa,SAAS;oBAAU;gBACxD;YACF;QACF;IACF;IAEA,OAAO,OAAO,yBAAyB,IAAI,SAAS;AACtD","debugId":null}}]
}